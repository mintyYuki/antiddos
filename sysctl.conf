#
# Modified sysctl.conf by https://github.com/yuk1c/antiddos [beta]
#

# Reverse-Path filtering, aka Spoof protection.
# 0 = Disabled, 1 = Strict, 2 = Loose
# You need to comment these parameters if you're using an asymmetric routing.
# ================================================================
 net.ipv4.conf.default.rp_filter = 1    # For all new interfaces
 net.ipv4.conf.all.rp_filter = 1        # For all current interfaces

# Always-on syncookies.
# You don't need this (!) unless you're being fried by a SYN Flood.
# ================================================================
# net.ipv4.tcp_syncookies = 2

# Do less SYN/SYN-ACK retries.
# ================================================================
 net.ipv4.tcp_synack_retries = 1
 net.ipv4.tcp_syn_retries = 1

# Don't accept new connections if the TCP backlog is full.
# Lowers the CPU load if someone is attacking your server and bypassing the rules.
# ================================================================
 net.ipv4.tcp_abort_on_overflow = 1

# Increase the limit of established connections.
# High values aren't really good, BTW.
# ================================================================
 net.core.somaxconn = 8192

# Make your [TCP] network stack compliant with RFC 1337.
# Slightly improves stability and security.
# ================================================================
 net.ipv4.tcp_rfc1337 = 1

# IPv4 Forwarding (if you use the script on a router).
# Also you need this if you use a VPN.
# Not enabled by default for security reasons.
# ================================================================
 #net.ipv4.ip_forward = 1


# Other tweaks.
# ================================================================
 net.netfilter.nf_conntrack_tcp_loose = 0               # Turn on strict TCP mode for conntrack.
 net.netfilter.nf_conntrack_tcp_ignore_invalid_rst = 1  # Ignore invalid RST packets.
 net.netfilter.nf_conntrack_checksum = 0                # Don't perform checksum calculations by NF. Your server's NIC is probably already doing that.
 net.ipv4.tcp_mtu_probing = 0                           # Do not use TCP MTU probing for additional security & lower CPU load. (it might not be 'the best' for overall performance. You can try these: 1 = TCP MTU Probing when an ICMP BlackHole detected, 2 = Always-on TCP MTU Probing)
 kernel.unprivileged_userns_clone = 0                   # Don't allow unprivileged user namespaces.
 net.ipv4.tcp_thin_linear_timeouts = 1                  # Enable dynamic triggering of thin linear timeouts (for lower TCP retransmission latencies)
 net.ipv4.conf.all.ignore_routes_with_linkdown = 1      # Ignore [IPv4] routes via interfaces that are down. Good for additional reliability.
 net.ipv6.conf.all.ignore_routes_with_linkdown = 1      # Ignore [IPv6] routes via interfaces that are down. Good for additional reliability.
 net.ipv4.ip_local_port_range = 1024 65535              # Increase the range of source ports for less possible port conflicts.
 net.ipv4.igmp_link_local_mcast_reports = 0             # Don't send IGMP Link-Local multicast reports.
 net.ipv4.ip_autobind_reuse = 1                         # Improve performance for high network loads by reusing local ports.
 net.core.bpf_jit_harden = 1                            # BPF-JIT Hardening.
 net.ipv4.conf.all.drop_unicast_in_l2_multicast = 1     # Drop IPv4 unicast packets encapsulated in link-layer multicast/broadcast frames.
 net.ipv6.conf.all.drop_unicast_in_l2_multicast = 1     # Drop IPv6 unicast packets encapsulated in link-layer multicast/broadcast frames.
 net.ipv4.conf.all.arp_filter = 1                       # ARP Protection (filter).
 net.ipv4.conf.all.arp_ignore = 1                       # Reply to an ARP request only if the target IP address is local address configured on the incoming interface.
 net.ipv4.tcp_shrink_window = 1                         # Shrink TCP RWIN when it's necessary. Good for stability and performance.
 net.ipv4.tcp_tw_reuse = 1                              # Reuse TIME_WAIT sockets for new TCP connections. Good for performance.
 net.ipv6.icmp.echo_ignore_multicast = 1                # Ignore ICMPv6 multicast echos.
 net.ipv6.conf.all.drop_unsolicited_na = 1              # Your server received a NA packet but hasn't asked for it with a NS packet? Drop it.

# Exclusive tweaks.
# ================================================================
 kernel.io_delay_type = 0           # On newer systems, I/O delay is useless, so we can turn it off.
 vm.memfd_noexec = 1                # Don't allow execution of memory-backed files created with 'memfd_create()' (for security).
 vm.numa_stat = 0                   # Turn off NUMA statistics.
 #kernel.soft_watchdog = 0           # Turn off kernel soft-lockup detector. (for a very minor performance gain)